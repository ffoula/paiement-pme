<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement PME - Congo Brazzaville</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #0077B6 0%, #00B4D8 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 1rem; }
        h2 { text-align: center; margin-bottom: 1rem; color: #2c3e50; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { width: 100%; padding: 12px; background: #0077B6; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 0.5rem; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-mtn { background: #FFCC00; color: black; }
        .btn-airtel { background: #E60A2B; color: white; }
        .hidden { display: none; }
        .transaction { border: 1px solid #eee; padding: 1rem; margin-bottom: 0.5rem; border-radius: 5px; }
        .amount { font-size: 1.2rem; font-weight: bold; color: #27ae60; }
        .nav { display: flex; margin-bottom: 1rem; }
        .nav-btn { flex: 1; padding: 1rem; background: #34495e; color: white; border: none; cursor: pointer; }
        .nav-btn.active { background: #0077B6; }
        .method-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; }
        .method-mtn { background: #FFCC00; color: black; }
        .method-airtel { background: #E60A2B; color: white; }
        .method-carte { background: #0077B6; color: white; }
        .method-especes { background: #27ae60; color: white; }
        .welcome-header { text-align: center; margin-bottom: 2rem; }
        .welcome-header h1 { color: white; font-size: 2rem; margin-bottom: 0.5rem; }
        .welcome-header p { color: white; opacity: 0.9; }
        .seller-info { background: #e8f5e8; padding: 1rem; border-radius: 5px; margin-bottom: 1rem; }
        .instructions { background: #fff3cd; padding: 1rem; border-radius: 5px; margin: 1rem 0; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <div class="welcome-header">
        <h1>üè™ Paiement PME</h1>
        <p>Recevez l'argent directement sur votre mobile !</p>
    </div>

    <div class="container">
        <!-- √âcran d'accueil -->
        <div id="welcomeScreen" class="card">
            <h2>üá®üá¨ Bienvenue</h2>
            <p style="text-align: center; margin-bottom: 1rem;">Recevez les paiements sur votre mobile MTN ou Airtel</p>
            
            <button class="btn" onclick="showLogin()">Se connecter</button>
            <button class="btn btn-success" onclick="showRegister()">Cr√©er un compte</button>
            
            <div class="instructions">
                <h4>üí° Comment √ßa marche :</h4>
                <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                    <li><strong>Inscrivez votre num√©ro de mobile</strong> (MTN ou Airtel)</li>
                    <li><strong>Le client paie</strong> avec son mobile</li>
                    <li><strong>Vous recevez l'argent</strong> instantan√©ment sur votre compte mobile</li>
                    <li><strong>Transaction enregistr√©e</strong> automatiquement</li>
                </ol>
            </div>

            <div style="margin-top: 1rem; text-align: center;">
                <h4>üìû Support</h4>
                <p>+242 05 XXX XXXX<br>support@pme.cg</p>
            </div>
        </div>

        <!-- Connexion -->
        <div id="loginScreen" class="card hidden">
            <h2>Connexion Entreprise</h2>
            <div class="form-group">
                <label>Email :</label>
                <input type="email" id="loginEmail" placeholder="votre@entreprise.cg">
            </div>
            <div class="form-group">
                <label>Mot de passe :</label>
                <input type="password" id="loginPassword" placeholder="Votre mot de passe">
            </div>
            <button class="btn" onclick="login()">Se connecter</button>
            <button class="btn" onclick="showWelcome()">Retour</button>
        </div>

        <!-- Inscription -->
        <div id="registerScreen" class="card hidden">
            <h2>Inscription Entreprise</h2>
            <div class="form-group">
                <label>Nom de l'entreprise :</label>
                <input type="text" id="regCompany" placeholder="Ex: Supermarch√© XYZ">
            </div>
            <div class="form-group">
                <label>Email :</label>
                <input type="email" id="regEmail" placeholder="contact@entreprise.cg">
            </div>
            <div class="form-group">
                <label>Votre num√©ro de mobile * :</label>
                <input type="tel" id="regPhone" placeholder="+242 05 XXX XXXX" required>
                <small style="color: #666;">Ce num√©ro recevra les paiements</small>
            </div>
            <div class="form-group">
                <label>Op√©rateur mobile * :</label>
                <select id="regOperator" required>
                    <option value="">Choisissez votre op√©rateur</option>
                    <option value="mtn">üì± MTN Congo</option>
                    <option value="airtel">üì± Airtel Congo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Mot de passe :</label>
                <input type="password" id="regPassword" placeholder="Min. 6 caract√®res">
            </div>
            
            <div class="seller-info">
                <h4>üí∞ Votre compte de reception :</h4>
                <p id="previewAccount">Aucun num√©ro saisi</p>
            </div>
            
            <button class="btn btn-success" onclick="register()">S'inscrire</button>
            <button class="btn" onclick="showWelcome()">Retour</button>
        </div>

        <!-- Tableau de bord -->
        <div id="dashboard" class="hidden">
            <div class="card">
                <h2 id="companyName">Mon Entreprise</h2>
                <div class="seller-info">
                    <strong>üìû Votre num√©ro de reception :</strong>
                    <div id="sellerPhoneDisplay">Chargement...</div>
                    <small>Les clients envoient l'argent sur ce num√©ro</small>
                </div>
                <button class="btn btn-danger" onclick="logout()">D√©connexion</button>
            </div>

            <div class="nav">
                <button class="nav-btn active" onclick="showTab('payment')">üí≥ Nouveau Paiement</button>
                <button class="nav-btn" onclick="showTab('history')">üìä Historique</button>
                <button class="nav-btn" onclick="showTab('account')">üë§ Mon Compte</button>
            </div>

            <!-- Onglet Paiement -->
            <div id="paymentTab" class="card">
                <h3>Nouvelle Transaction</h3>
                
                <div class="instructions">
                    <strong>Instructions pour le client :</strong>
                    <p id="paymentInstructions">Veuillez configurer votre compte d'abord</p>
                </div>
                
                <div class="form-group">
                    <label>Montant √† recevoir (FCFA) :</label>
                    <input type="number" id="amount" placeholder="10000" min="100">
                </div>
                <div class="form-group">
                    <label>Description :</label>
                    <input type="text" id="description" placeholder="Ex: Vente produits alimentaires">
                </div>
                <div class="form-group">
                    <label>Nom du client :</label>
                    <input type="text" id="client" placeholder="Ex: Monsieur Diallo">
                </div>
                <div class="form-group">
                    <label>T√©l√©phone client :</label>
                    <input type="tel" id="clientPhone" placeholder="+242 05 XXX XXXX">
                </div>
                
                <button class="btn btn-success" onclick="createPaymentRequest()">üì± G√©n√©rer demande de paiement</button>
            </div>

            <!-- Onglet Historique -->
            <div id="historyTab" class="card hidden">
                <h3>Historique des Transactions</h3>
                <button class="btn" onclick="exportData()">üì• Exporter CSV</button>
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                    <input type="date" id="startDate" style="flex: 1;">
                    <input type="date" id="endDate" style="flex: 1;">
                    <button class="btn" onclick="filterTransactions()">Filtrer</button>
                </div>
                <div id="transactions" style="margin-top: 1rem;">
                    <p>Aucune transaction pour le moment.</p>
                </div>
            </div>

            <!-- Onglet Compte -->
            <div id="accountTab" class="card hidden">
                <h3>üë§ Mon Compte de Reception</h3>
                
                <div class="seller-info">
                    <h4>üí∞ Votre compte mobile :</h4>
                    <p><strong>Num√©ro :</strong> <span id="accountPhone"></span></p>
                    <p><strong>Op√©rateur :</strong> <span id="accountOperator"></span></p>
                    <p><strong>Statut :</strong> <span style="color: #27ae60;">‚óè Actif</span></p>
                </div>
                
                <div class="instructions">
                    <h4>üìã Comment recevoir l'argent :</h4>
                    <p><strong>Pour MTN Money :</strong><br>
                    Le client fait *133*1*VOTRE_NUMERO*MONTANT#</p>
                    
                    <p><strong>Pour Airtel Money :</strong><br>
                    Le client fait *127*1*VOTRE_NUMERO*MONTANT#</p>
                </div>
                
                <button class="btn" onclick="updateAccount()">Modifier le num√©ro</button>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es de l'application
        let entreprises = JSON.parse(localStorage.getItem('entreprises')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let currentUser = null;

        // M√©thodes de paiement avec codes USSD
        const paymentMethods = {
            'mtn': { 
                name: 'MTN Money', 
                class: 'method-mtn', 
                icon: 'üì±',
                ussd: '*133*1*{sellerPhone}*{amount}#',
                instructions: 'Dites au client de composer : *133*1*[VOTRE_NUMERO]*[MONTANT]#'
            },
            'airtel': { 
                name: 'Airtel Money', 
                class: 'method-airtel', 
                icon: 'üì±',
                ussd: '*127*1*{sellerPhone}*{amount}#',
                instructions: 'Dites au client de composer : *127*1*[VOTRE_NUMERO]*[MONTANT]#'
            }
        };

        // Navigation
        function showWelcome() { showScreen('welcomeScreen'); }
        function showLogin() { showScreen('loginScreen'); }
        function showRegister() { showScreen('registerScreen'); }
        
        function showScreen(screenId) {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showTab(tabId) {
            document.getElementById('paymentTab').classList.add('hidden');
            document.getElementById('historyTab').classList.add('hidden');
            document.getElementById('accountTab').classList.add('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId + 'Tab').classList.remove('hidden');
            event.target.classList.add('active');
            
            if (tabId === 'history') loadTransactions();
            if (tabId === 'account') loadAccountInfo();
        }

        // Mise √† jour de l'aper√ßu du compte
        document.getElementById('regPhone').addEventListener('input', updateAccountPreview);
        document.getElementById('regOperator').addEventListener('change', updateAccountPreview);

        function updateAccountPreview() {
            const phone = document.getElementById('regPhone').value;
            const operator = document.getElementById('regOperator').value;
            const preview = document.getElementById('previewAccount');
            
            if (phone && operator) {
                const operatorInfo = paymentMethods[operator];
                preview.innerHTML = `<strong>${operatorInfo.icon} ${operatorInfo.name}</strong><br>${phone}`;
            } else {
                preview.textContent = 'Aucun num√©ro saisi';
            }
        }

        // Authentification
        function register() {
            const company = document.getElementById('regCompany').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const operator = document.getElementById('regOperator').value;
            const password = document.getElementById('regPassword').value;

            if (!company || !email || !phone || !operator || !password) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            // V√©rifier le format du num√©ro
            if (!phone.startsWith('+242') || phone.length < 12) {
                alert('‚ùå Format de num√©ro invalide. Utilisez le format: +242 05 XXX XXXX');
                return;
            }

            // V√©rifier si l'email existe d√©j√†
            if (entreprises.find(e => e.email === email)) {
                alert('‚ùå Un compte avec cet email existe d√©j√†');
                return;
            }

            entreprises.push({ company, email, phone, operator, password });
            localStorage.setItem('entreprises', JSON.stringify(entreprises));
            
            currentUser = { company, email, phone, operator };
            showDashboard();
            alert('‚úÖ Compte cr√©√© avec succ√®s! Vous pouvez maintenant recevoir des paiements sur ' + phone);
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const entreprise = entreprises.find(e => e.email === email && e.password === password);
            if (entreprise) {
                currentUser = entreprise;
                showDashboard();
                alert('‚úÖ Connexion r√©ussie! Bienvenue ' + entreprise.company);
            } else {
                alert('‚ùå Email ou mot de passe incorrect');
            }
        }

        function showDashboard() {
            document.getElementById('companyName').textContent = currentUser.company;
            document.getElementById('sellerPhoneDisplay').innerHTML = 
                `<strong>${paymentMethods[currentUser.operator].icon} ${currentUser.phone}</strong>`;
            updatePaymentInstructions();
            showScreen('dashboard');
        }

        function logout() {
            currentUser = null;
            showWelcome();
        }

        // Gestion des paiements
        function updatePaymentInstructions() {
            const instructions = document.getElementById('paymentInstructions');
            const operatorInfo = paymentMethods[currentUser.operator];
            
            instructions.innerHTML = `
                <strong>Donnez ces instructions au client :</strong><br>
                "${operatorInfo.instructions.replace('[VOTRE_NUMERO]', currentUser.phone)}"
            `;
        }

        function createPaymentRequest() {
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;
            const client = document.getElementById('client').value;
            const clientPhone = document.getElementById('clientPhone').value;

            if (!amount || !description || !client) {
                alert('Veuillez remplir le montant, la description et le nom du client');
                return;
            }

            const operatorInfo = paymentMethods[currentUser.operator];
            const ussdCode = operatorInfo.ussd
                .replace('{sellerPhone}', currentUser.phone.replace('+', ''))
                .replace('{amount}', amount);

            // Cr√©er la transaction
            const transaction = {
                id: Date.now(),
                company: currentUser.company,
                amount: parseFloat(amount),
                method: currentUser.operator,
                methodName: operatorInfo.name,
                description: description,
                client: client,
                clientPhone: clientPhone,
                sellerPhone: currentUser.phone,
                ussdCode: ussdCode,
                status: 'en_attente',
                date: new Date().toISOString(),
                dateDisplay: new Date().toLocaleString('fr-FR')
            };

            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));

            // Afficher les instructions de paiement
            const message = `
üí∞ **DEMANDE DE PAIEMENT CR√â√âE**

**Montant :** ${amount} FCFA
**Client :** ${client}
**Description :** ${description}

üì± **INSTRUCTIONS POUR LE CLIENT :**

"*Veuillez composer sur votre mobile :*"

${ussdCode}

"*Une fois le paiement effectu√©, la transaction sera confirm√©e automatiquement.*"

‚úÖ **Vous recevrez ${amount} FCFA sur votre ${operatorInfo.name}**
            `;

            alert(message);
            
            // R√©initialiser le formulaire
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            document.getElementById('client').value = '';
            document.getElementById('clientPhone').value = '';
        }

        function loadTransactions() {
            const userTransactions = transactions.filter(t => t.company === currentUser.company);
            const container = document.getElementById('transactions');

            if (userTransactions.length === 0) {
                container.innerHTML = '<p>Aucune transaction pour le moment.</p>';
                return;
            }

            let html = '';
            userTransactions.reverse().forEach(transaction => {
                const statusColor = transaction.status === 'complet√©' ? '#27ae60' : 
                                  transaction.status === 'en_attente' ? '#f39c12' : '#e74c3c';
                
                html += `
                    <div class="transaction">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div class="amount">${transaction.amount.toLocaleString()} FCFA</div>
                            <span class="method-badge ${paymentMethods[transaction.method].class}">
                                ${paymentMethods[transaction.method].icon} ${transaction.methodName}
                            </span>
                        </div>
                        <div><strong>Description:</strong> ${transaction.description}</div>
                        <div><strong>Client:</strong> ${transaction.client}</div>
                        ${transaction.clientPhone ? `<div><strong>T√©l√©phone client:</strong> ${transaction.clientPhone}</div>` : ''}
                        <div><strong>Statut:</strong> <span style="color: ${statusColor}">${transaction.status}</span></div>
                        <div><strong>Date:</strong> ${transaction.dateDisplay}</div>
                        ${transaction.ussdCode ? `<div style="margin-top: 0.5rem; background: #f8f9fa; padding: 0.5rem; border-radius: 3px; font-family: monospace; font-size: 0.9rem;">
                            <strong>Code USSD:</strong> ${transaction.ussdCode}
                        </div>` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function loadAccountInfo() {
            document.getElementById('accountPhone').textContent = currentUser.phone;
            document.getElementById('accountOperator').textContent = paymentMethods[currentUser.operator].name;
        }

        function updateAccount() {
            const newPhone = prompt('Nouveau num√©ro de mobile (+242 ...):', currentUser.phone);
            if (newPhone && newPhone.startsWith('+242') && newPhone.length >= 12) {
                // Mettre √† jour dans les donn√©es
                const entrepriseIndex = entreprises.findIndex(e => e.email === currentUser.email);
                if (entrepriseIndex !== -1) {
                    entreprises[entrepriseIndex].phone = newPhone;
                    localStorage.setItem('entreprises', JSON.stringify(entreprises));
                    currentUser.phone = newPhone;
                    showDashboard();
                    alert('‚úÖ Num√©ro mis √† jour avec succ√®s!');
                }
            } else if (newPhone) {
                alert('‚ùå Format de num√©ro invalide. Utilisez le format: +242 05 XXX XXXX');
            }
        }

        function filterTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let filteredTransactions = transactions.filter(t => t.company === currentUser.company);
            
            if (startDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date >= startDate + 'T00:00:00');
            }
            
            if (endDate) {
                filteredTransactions = filteredTransactions.filter(t => t.date <= endDate + 'T23:59:59');
            }
            
            const container = document.getElementById('transactions');
            let html = '';
            filteredTransactions.reverse().forEach(transaction => {
                const statusColor = transaction.status === 'complet√©' ? '#27ae60' : 
                                  transaction.status === 'en_attente' ? '#f39c12' : '#e74c3c';
                
                html += `
                    <div class="transaction">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div class="amount">${transaction.amount.toLocaleString()} FCFA</div>
                            <span class="method-badge ${paymentMethods[transaction.method].class}">
                                ${paymentMethods[transaction.method].icon} ${transaction.methodName}
                            </span>
                        </div>
                        <div><strong>Description:</strong> ${transaction.description}</div>
                        <div><strong>Client:</strong> ${transaction.client}</div>
                        <div><strong>Statut:</strong> <span style="color: ${statusColor}">${transaction.status}</span></div>
                        <div><strong>Date:</strong> ${transaction.dateDisplay}</div>
                    </div>
                `;
            });

            container.innerHTML = html || '<p>Aucune transaction trouv√©e pour cette p√©riode.</p>';
        }

        function exportData() {
            const userTransactions = transactions.filter(t => t.company === currentUser.company);
            
            if (userTransactions.length === 0) {
                alert('Aucune transaction √† exporter');
                return;
            }

            let csv = 'ID;Date;Montant;M√©thode;Description;Client;T√©l√©phone Client;Statut;Votre Num√©ro\n';
            userTransactions.forEach(transaction => {
                csv += `${transaction.id};${transaction.dateDisplay};${transaction.amount};${transaction.methodName};"${transaction.description}";"${transaction.client}";"${transaction.clientPhone || ''}";${transaction.status};${transaction.sellerPhone}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `transactions_${currentUser.company}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('üìä Fichier CSV export√© avec succ√®s!');
        }

        // Simulation de r√©ception de paiement (pour la d√©mo)
        function simulatePayment(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (transaction) {
                transaction.status = 'complet√©';
                localStorage.setItem('transactions', JSON.stringify(transactions));
                alert(`‚úÖ Paiement re√ßu! ${transaction.amount} FCFA ont √©t√© cr√©dit√©s sur ${transaction.sellerPhone}`);
                loadTransactions();
            }
        }

        // Initialisation
        showWelcome();

        // Remplir les dates par d√©faut
        const today = new Date().toISOString().split('T')[0];
        const firstDay = new Date();
        firstDay.setDate(1);
        const firstDayStr = firstDay.toISOString().split('T')[0];
        
        document.getElementById('startDate').value = firstDayStr;
        document.getElementById('endDate').value = today;
    </script>
</body>
</html>